<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Drag & Drop Reordering with Touch Scroll</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 400px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 1rem;
      overflow: hidden;
    }
    h2 {
      text-align: center;
      margin-top: 0;
    }
    .list-group {
      list-style: none;
      padding: 0;
      margin: 0;
      overflow-y: auto;
      max-height: 400px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
    }
    .list-group::-webkit-scrollbar {
      width: 8px;
      background: #eee;
    }
    .list-group::-webkit-scrollbar-thumb {
      background: #c5c5c5;
      border-radius: 8px;
    }
    .list-group-item {
      background: #f9fafb;
      margin-bottom: 6px;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      cursor: grab;
      transition: box-shadow 0.18s, transform 0.18s;
      touch-action: pan-y;
      position: relative;
      z-index: 0;
    }
    .list-group-item.dragging {
      opacity: 0.6;
      background: #e0e7ef;
      box-shadow: 0 4px 18px rgba(0,0,0,0.09);
      z-index: 100;
      transform: scale(1.03);
    }
    .list-group-item.placeholder {
      background: #d6f0ff;
      border: 2px dashed #3b82f6;
      min-height: 40px;
      opacity: 0.7;
      margin-bottom: 6px;
    }
    @media (hover:none) and (pointer:coarse) {
      .list-group-item {
        font-size: 1.1rem;
        padding: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Reorder Your List</h2>
    <ul class="list-group" id="draggable-list">
      <li class="list-group-item" draggable="true">First Item</li>
      <li class="list-group-item" draggable="true">Second Item</li>
      <li class="list-group-item" draggable="true">Third Item</li>
      <li class="list-group-item" draggable="true">Fourth Item</li>
      <li class="list-group-item" draggable="true">Fifth Item</li>
    </ul>
    <p style="color: #888; font-size: 0.95em; text-align: center; margin-top: 0.5rem;">
      Drag items to reorder. Works great on mobile!
    </p>
  </div>
  <script>
    // --- Drag & Drop logic, supports pointer/touch events for mobile ---
    const list = document.getElementById('draggable-list');
    let dragEl, placeholder, startY, offsetY, startScrollTop;

    function getListItems() {
      return Array.from(list.children).filter(li => !li.classList.contains('placeholder'));
    }

    function createPlaceholder(height) {
      const ph = document.createElement('li');
      ph.className = 'list-group-item placeholder';
      ph.style.height = height + 'px';
      return ph;
    }

    function pointerDown(e) {
      const target = e.target.closest('.list-group-item');
      if (!target || target.classList.contains('placeholder')) return;

      dragEl = target;
      dragEl.classList.add('dragging');
      dragEl.setAttribute('aria-grabbed', 'true');
      startY = e.touches ? e.touches[0].clientY : e.clientY;
      offsetY = startY - dragEl.getBoundingClientRect().top;
      startScrollTop = list.scrollTop;

      // Insert placeholder
      placeholder = createPlaceholder(dragEl.offsetHeight);
      dragEl.parentNode.insertBefore(placeholder, dragEl.nextSibling);

      // For touch devices, disable vertical scrolling until drag ends
      list.style.overflowY = 'hidden';

      document.addEventListener(e.type === 'touchstart' ? 'touchmove' : 'mousemove', pointerMove);
      document.addEventListener(e.type === 'touchstart' ? 'touchend' : 'mouseup', pointerUp);
    }

    function pointerMove(e) {
      if (!dragEl) return;
      e.preventDefault();

      // Calculate new Y position
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      const newTop = clientY - offsetY + list.scrollTop - startScrollTop;

      dragEl.style.position = 'absolute';
      dragEl.style.width = `${dragEl.offsetWidth}px`;
      dragEl.style.left = '0';
      dragEl.style.top = `${newTop}px`;

      // Scroll the list vertically if dragging near edge (for mobile)
      const listRect = list.getBoundingClientRect();
      if (clientY < listRect.top + 50) {
        list.scrollTop -= 18;
      } else if (clientY > listRect.bottom - 50) {
        list.scrollTop += 18;
      }

      // Find target index for placeholder
      const items = getListItems();
      let insertBefore = null;
      for (let li of items) {
        const rect = li.getBoundingClientRect();
        if (clientY < rect.top + rect.height / 2) {
          insertBefore = li;
          break;
        }
      }
      if (insertBefore) {
        list.insertBefore(placeholder, insertBefore);
      } else {
        list.appendChild(placeholder);
      }
    }

    function pointerUp(e) {
      if (!dragEl) return;

      dragEl.classList.remove('dragging');
      dragEl.removeAttribute('aria-grabbed');
      dragEl.style.position = '';
      dragEl.style.width = '';
      dragEl.style.left = '';
      dragEl.style.top = '';

      // Move dragged element to placeholder position
      if (placeholder && placeholder.parentNode) {
        list.insertBefore(dragEl, placeholder);
        placeholder.remove();
        placeholder = null;
      }

      dragEl = null;
      list.style.overflowY = 'auto';

      document.removeEventListener(e.type === 'touchend' ? 'touchmove' : 'mousemove', pointerMove);
      document.removeEventListener(e.type === 'touchend' ? 'touchend' : 'mouseup', pointerUp);
    }

    // Support both pointer and touch
    list.addEventListener('mousedown', pointerDown);
    list.addEventListener('touchstart', pointerDown, { passive: false });

    // Accessibility: Allow keyboard reordering (optional, for desktop)
    list.addEventListener('keydown', function(e) {
      const focused = document.activeElement;
      if (!focused.classList.contains('list-group-item')) return;
      if (e.key === "ArrowUp" || e.key === "ArrowDown") {
        e.preventDefault();
        const items = getListItems();
        const idx = items.indexOf(focused);
        const nextIdx = e.key === "ArrowUp" ? Math.max(0, idx-1) : Math.min(items.length-1, idx+1);
        if (idx !== nextIdx) {
          list.insertBefore(focused, e.key === "ArrowUp" ? items[nextIdx] : items[nextIdx].nextSibling);
          focused.focus();
        }
      }
    });
    // Make items focusable for keyboard access
    getListItems().forEach(li => li.setAttribute('tabindex', '0'));
  </script>
</body>
</html>
